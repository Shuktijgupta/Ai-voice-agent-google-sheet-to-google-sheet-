# Self-Hosted Voice AI Agent Setup Guide

Complete guide to set up a **fully self-hosted voice AI agent** that makes calls, speaks, listens, and reports back - all without paid AI services!

## ğŸ¯ What You'll Get

âœ… **Automatic phone calls** via Twilio  
âœ… **AI conversation** using Ollama (local)  
âœ… **Text-to-Speech** using local TTS  
âœ… **Speech Recognition** using local ASR  
âœ… **Call recording**  
âœ… **Call transcript**  
âœ… **Call duration**  
âœ… **Call summary**  

**No paid AI services required!** Only need a Twilio phone number.

## ğŸ“‹ Prerequisites

1. **Ollama** âœ… (Already installed)
2. **Twilio Account** (Get from https://twilio.com)
3. **Node.js** âœ… (Already installed)
4. **Python 3.8+** (For TTS/ASR services)

## ğŸš€ Step-by-Step Setup

### Step 1: Get Twilio Credentials

1. Sign up at https://twilio.com (free trial available)
2. Get a phone number from Twilio
3. Get your credentials:
   - Account SID
   - Auth Token
   - Phone Number

### Step 2: Configure Environment Variables

Add to your `.env` file:

```env
# Twilio Configuration (Required)
TWILIO_ACCOUNT_SID=your_account_sid
TWILIO_AUTH_TOKEN=your_auth_token
TWILIO_PHONE_NUMBER=+1234567890

# Ollama (Already configured)
OLLAMA_URL=http://localhost:11434
OLLAMA_MODEL=llama3.2:3b

# TTS Provider (Choose one)
TTS_PROVIDER=piper  # or 'coqui' or 'espeak'
TTS_SERVER_URL=http://localhost:5000  # If using server

# ASR Provider (Choose one)
ASR_PROVIDER=whisper  # or 'vosk'
ASR_SERVER_URL=http://localhost:8000  # If using server

# App URL (for webhooks)
NEXT_PUBLIC_APP_URL=http://localhost:3000
```

### Step 3: Install TTS (Text-to-Speech)

**Option A: Piper TTS (Recommended - Fast & Lightweight)**

```bash
# Install Piper
pip install piper-tts

# Or use Docker
docker run -d -p 5000:5000 rhasspy/piper-tts
```

**Option B: Coqui TTS (High Quality)**

```bash
pip install TTS
# Start TTS server
tts-server --port 5000
```

**Option C: Espeak (Simple Fallback)**

```bash
# macOS
brew install espeak-ng

# Linux
sudo apt-get install espeak-ng
```

### Step 4: Install ASR (Automatic Speech Recognition)

**Option A: Whisper.cpp (Recommended - High Accuracy)**

```bash
# Install Whisper.cpp
git clone https://github.com/ggerganov/whisper.cpp
cd whisper.cpp
make

# Or use Docker
docker run -d -p 8000:8000 onerahmet/openai-whisper-asr-webservice:latest-gpu
```

**Option B: Vosk (Lightweight & Fast)**

```bash
pip install vosk
# Download model
wget https://alphacephei.com/vosk/models/vosk-model-small-hi-0.22.zip
unzip vosk-model-small-hi-0.22.zip
```

### Step 5: Start Services

```bash
# Terminal 1: Start Ollama (if not running)
brew services start ollama  # macOS
# or
ollama serve  # Linux

# Terminal 2: Start TTS Server (if using server mode)
# For Piper:
docker run -d -p 5000:5000 rhasspy/piper-tts

# Terminal 3: Start ASR Server (if using server mode)
# For Whisper:
docker run -d -p 8000:8000 onerahmet/openai-whisper-asr-webservice:latest-gpu

# Terminal 4: Start your app
npm run dev
```

### Step 6: Test the Setup

```bash
# Test Ollama
curl http://localhost:11434/api/tags

# Test TTS (if using server)
curl http://localhost:5000/health

# Test ASR (if using server)
curl http://localhost:8000/health
```

## ğŸ“ Making Calls

### Via API

```bash
POST /api/self-hosted-voice/start-call
Content-Type: application/json

{
  "driverId": "driver-uuid",
  "agentId": "agent-uuid"  // optional
}
```

### Via UI

1. Go to Drivers page
2. Click "AI Call" button
3. The self-hosted voice agent will:
   - Call the driver via Twilio
   - Speak using local TTS
   - Listen using local ASR
   - Respond using Ollama
   - Record the call
   - Generate transcript
   - Save everything to database

## ğŸ”§ Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Twilio    â”‚ â† Makes phone call
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Webhook Handlerâ”‚ â† Receives call events
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â–º Ollama (LLM) â† Generates responses
       â”‚
       â”œâ”€â”€â–º Local TTS â† Converts text to speech
       â”‚
       â”œâ”€â”€â–º Local ASR â† Converts speech to text
       â”‚
       â””â”€â”€â–º Database â† Saves recording, transcript, summary
```

## ğŸ“Š What Gets Saved

After each call:

1. **Call Record** in database with:
   - Call ID
   - Driver ID
   - Start/End time
   - Duration
   - Status

2. **Recording URL** (from Twilio)

3. **Transcript** (generated by local ASR)

4. **Summary** (generated by Ollama)

5. **Extracted Answers** (parsed by Ollama)

## ğŸ› Troubleshooting

### Calls not connecting
- Check Twilio credentials in `.env`
- Verify phone number format (E.164)
- Check webhook URL is accessible

### No speech
- Verify TTS service is running
- Check `TTS_PROVIDER` in `.env`
- Test TTS endpoint directly

### No transcription
- Verify ASR service is running
- Check `ASR_PROVIDER` in `.env`
- Test ASR endpoint directly

### Slow responses
- Use faster TTS (Piper) instead of Coqui
- Use faster ASR (Vosk) instead of Whisper
- Use smaller Ollama model (llama3.2:3b)

## ğŸ’° Cost Breakdown

**Free:**
- Ollama (local)
- Local TTS (local)
- Local ASR (local)
- Your server

**Paid:**
- Twilio phone number: ~$1/month
- Twilio call minutes: ~$0.01-0.02/minute

**Total:** ~$1/month + call minutes (much cheaper than Bland AI!)

## âœ… Next Steps

1. **Install TTS** (choose Piper for speed or Coqui for quality)
2. **Install ASR** (choose Whisper for accuracy or Vosk for speed)
3. **Configure Twilio** credentials
4. **Test a call** via the API
5. **Monitor** call quality and adjust

## ğŸ‰ Success!

Once set up, you'll have a **completely self-hosted voice AI agent** that:
- Makes calls automatically
- Speaks naturally
- Understands responses
- Records everything
- Generates transcripts
- Creates summaries

**All without paying for AI services!**






